<html>
  <head>
    <link href="style.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <div class="main">
      <div class="leftItem">
        <button onclick="check()">arraydata</button>
        <input type="file" id="file" onchange="addImg(this.files)" />
        <label for="file">upload</label>
        <div class="colorData">
          <label>координаты:</label>
          <span id="coord"></span>
          <label> цвет hex:</label>
          <span id="color"></span>
          <label> цвет rgba:</label>
          <span id="rgba"></span>
          <div id="output"></div>
          <div id="output2"></div>
        </div>
      </div>
      <img src="" />
      <canvas id="canv"></canvas>
    </div>
  </body>
  <script>
    let arrayData = ["1231"];
    let data;
    function addImg(a) {
      let img = document.querySelector("img");
      img.src = URL.createObjectURL(a[0]);
      img.onload = () => calculate();
    }

    function calculate() {
      let canv = document.getElementById("canv");
      let img = document.querySelector("img");
      canv.width = img.width;
      canv.height = img.height;
      let qqq = canv.getContext("2d");
      qqq.drawImage(img, 0, 0, img.width, img.height);

      img.style.visibility = "hidden";

      data = qqq.getImageData(0, 0, canv.width, canv.height);
      getArrayOfColors(data.data);

      canv.addEventListener("mousemove", (e) => {
        showColor(qqq, e.offsetX, e.offsetY);
      });
      canv.addEventListener("click", (e) => {
        showColor(qqq, e.offsetX, e.offsetY, true);
      });
    }

    function showColor(context, x, y, isClicked) {
      // console.log(data);

      let localData = context.getImageData(x, y, 1, 1).data;
      let rgbacolor = `${localData[0]} ${localData[1]} ${localData[2]}`;
      let hexcolor = `${convertToHex(localData[0])}${convertToHex(localData[1])}${convertToHex(localData[2])}`;

      document.getElementById("coord").innerHTML = `${x}  ${y}`;
      document.getElementById("color").innerHTML = hexcolor;
      document.getElementById("rgba").innerHTML = rgbacolor;
      document.getElementById("output").style.backgroundColor = `#${hexcolor}`;
      document.getElementById("output2").style.backgroundColor = arrayData[y * data.width + x];

      console.log(arrayData[y * data.width + x]);

      if (isClicked) {
        console.log(`#${hexcolor}`);
      }
    }

    function convertToHex(dec) {
      let res = dec.toString(16);
      return res.length === 2 ? res : `0${res}`;
    }

    function getArrayOfColors(array4) {
      for (let i = 4; i < array4.length; i++) {
        if (i % 4 === 0) {
          arrayData.push(`${convertToHex(array4[i - 4])}${convertToHex(array4[i - 3])}${convertToHex(array4[i - 2])}`);
        }
      }
    }

    function check() {
      console.log(arrayData);
    }
  </script>
</html>
